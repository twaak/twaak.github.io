---
title: "Windows server 2016 磁盘管理"
draft: false
date: 2024-07-10
description: "Windows server 2016 磁盘管理"
featuredImage: "https://img.myla.eu.org/file/2b0a4517645739888f8db.png"
tags: ["english","错题","小学"]
categories: ["english"]

---

#### **一、分区表格式**

GPT和MBR都是磁盘分区表格式，用于存储有关磁盘分区的信息。GPT是较新的格式，具有许多优势，包括：

- 支持更大的磁盘容量。MBR最多支持2TB的磁盘，而GPT支持高达18EB的磁盘。

- 支持更多分区。MBR最多支持**4个主分区**，而GPT支持**128个分区。**

- 更高的安全性。GPT使用循环冗余校验（CRC）来保护分区表数据，而MBR不使用CRC。

以下是GPT和MBR的详细比较：

| **特性**       | **GPT**               | **MBR**                 |
| -------------- | --------------------- | ----------------------- |
| 支持的磁盘容量 | 18EB                  | 2TB                     |
| 支持的分区数量 | 128                   | 4                       |
| 安全性         | 使用CRC保护分区表数据 | 不使用CRC保护分区表数据 |
| 兼容性         | 仅与UEFI系统兼容      | 与BIOS和UEFI系统兼容    |

#### 二、基本磁盘和动态磁盘

基本磁盘和动态磁盘是两种类型的存储器，用于在 Windows 操作系统中组织和管理数据。 它们在功能和灵活性方面存在一些关键差异。

**基本磁盘**

基本磁盘是传统类型的存储器，可用于大多数目的。 它们具有以下特点：

- 简单性：基本磁盘结构简单，易于理解和管理。

- 兼容性：基本磁盘与所有版本的 Windows 和大多数其他操作系统兼容。

- 启动支持：基本磁盘可用于安装和启动操作系统。

但是，基本磁盘也有一些限制：

- 分区限制：基本磁盘最多只能包含四个主分区或三个主分区和一个扩展分区。 扩展分区可以进一步划分为逻辑驱动器，但总分区数仍然有限。（MBR,GPT）

- 容错性：基本磁盘没有内置的容错功能。 如果物理磁盘发生故障，可能会导致数据丢失。

**动态磁盘**

动态磁盘是一种更高级的存储器类型，提供更大的灵活性和容错性。 它们具有以下特点：

- 卷支持：动态磁盘使用卷而不是分区来管理数据。 卷可以跨越多个物理磁盘，并且可以比基本分区更大。

- 容错卷：动态磁盘支持镜像和 RAID-5 卷等容错卷类型。 这些卷可以提供数据冗余，以防止在物理磁盘发生故障时丢失数据。

- 动态扩展：动态卷可以轻松扩展，而无需重新分区磁盘。

但是，动态磁盘也有一些限制：

- 兼容性：动态磁盘不与所有操作系统兼容。 只有较新的 Windows 版本才支持它们。

- 启动限制：动态卷不能用于启动操作系统。

**基本磁盘与动态磁盘的比较**

| **特性** | **基本磁盘** | **动态磁盘** |
| -------- | ------------ | ------------ |
| 复杂性   | 简单         | 复杂         |
| 兼容性   | 高           | 适中         |
| 启动支持 | 是           | 否           |
| 分区限制 | 受限         | 无           |
| 容错性   | 低           | 高           |
| 可扩展性 | 有限         | 高           |

三、动态磁盘卷

动态磁盘支持多种卷类型，每种类型都提供不同的功能和数据保护级别。 以下是最常见的动态磁盘卷类型： 

• **简单卷 (Simple volume)：** 简单卷是动态磁盘中最基本的卷类型。 它由单个物理磁盘或多个物理磁盘上的连续空间组成。 简单卷通常用于存储数据，例如文档、音乐和照片。 

• **跨区卷 (Spanned volume)：** 跨区卷由多个物理磁盘上的非连续空间组成。 它通常用于创建比单个物理磁盘更大的卷。 跨区卷通常用于存储大型文件，例如视频和音频文件。 

• **带区卷 (Striped volume)：** 带区卷由多个物理磁盘上的交织在一起的块组成。 它提供了比单个物理磁盘更高的 I/O 性能。 带区卷通常用于存储需要高性能的应用程序，例如数据库和 Web 服务器。

**带区卷的工作原理**

带区卷将数据块分配给卷中的每个物理磁盘。 当写入数据时，数据块将被写入到所有磁盘上的相应位置。 当读取数据时，数据块将从所有磁盘读取并重新组装。 这种并行操作可以提高读写速度。

例如，假设您有一个由三个物理磁盘组成的带区卷。 当您写入一个 10 MB 的文件时，该文件将被分割成三个 3.33 MB 的块，并分别写入到每个磁盘上。 当您读取该文件时，每个磁盘将读取其相应的 3.33 MB 块，然后将这些块重新组装成原始的 10 MB 文件。

**带区卷的优点**

带区卷的主要优点是提高了 I/O 性能。 由于数据分布在多个磁盘上，因此可以同时从多个磁盘读取和写入数据。 这对于需要高性能的应用程序（例如数据库和 Web 服务器）很有帮助。

带区卷的另一个优点是易于创建和管理。 只需将需要包含在卷中的物理磁盘添加到 LDM（逻辑磁盘管理器）即可。

**带区卷的缺点**

带区卷的主要缺点是没有任何数据冗余。 如果其中一个物理磁盘发生故障，整个卷将无法使用。 因此，不建议将带区卷用于存储关键数据。 

**镜像卷 (Mirrored volume)：** 镜像卷由两块或多块物理磁盘上的相同数据副本组成。 如果一块物理磁盘发生故障，另一块磁盘上的副本将用于保护数据。 镜像卷通常用于存储关键数据，例如操作系统和应用程序文件。

**镜像卷的工作原理**

镜像卷由至少两个物理磁盘组成。 当写入数据时，数据将被写入到所有镜像磁盘上。 这意味着每个磁盘都包含数据的完整副本。 当读取数据时，数据可以从任何镜像磁盘读取。

例如，假设您有一个由两个物理磁盘组成的镜像卷。 当您写入一个 10 MB 的文件时，该文件将被复制到两个磁盘上。 每个磁盘都包含文件的完整副本。 当您读取该文件时，您可以从任何磁盘读取文件。

**镜像卷的优点**

镜像卷的主要优点是数据冗余。 如果其中一个物理磁盘发生故障，另一个副本仍可用于恢复数据。 这对于存储关键数据至关重要，因为数据丢失可能会导致严重后果。

镜像卷的另一个优点是易于创建和管理。 只需将需要包含在卷中的物理磁盘添加到 LDM（逻辑磁盘管理器）即可。 LDM 将自动处理镜像和故障转移。

**镜像卷的缺点**

镜像卷的主要缺点是成本较高。 这是因为它们需要比简单卷或动态卷更多的物理磁盘。 此外，镜像卷会降低写入性能，因为必须将数据写入到所有镜像磁盘上。 

**RAID-5 卷 (RAID-5 volume)：** RAID-5 卷由三块或多块物理磁盘组成。 它使用一种称为奇偶校验的技术来保护数据。 如果一块物理磁盘发生故障，RAID-5 卷仍可继续运行，并且可以从奇偶校验数据重建丢失的数据。 RAID-5 卷通常用于存储需要高性能和数据保护的应用程序，例如数据库和文件服务器。

![](https://raw.githubusercontent.com/soslane/picgo/main/path/202407102150235.png)
## 一、KVM存储概念

**kvm存储的2个概念**

存储池：存储真实的载体

存储卷：逻辑的单个载体，可以理解为虚拟硬盘

**存储池的分类（载体）**

基于文件系统存储
基于存储设备

**–基于文件系统存储–**

dir：directory，目录方式存储
指的是具体的某个文件下存储卷，默认存储在/var/lib/libvirt/images

fs：formatted block storage，分区方式存储

指的是某个格式化的分区，机制其实就是mount挂载分区，在分区下存储卷

**区别：路径依赖，dir固定目录路径，fs可以挂载到任何文件路径下**

**netfs**：network exported directory，网络文件方式（远程存储）
指的是利用网络系统目录存储卷，比如Samba文件系统，NFS网络文件系统等远程方式
**使用这个方式作为KVM的存储是比较方便的，因为此方式能比较方便的从另外一台服务器上去访问，同样也允许你在多台主机上去访问同一个磁盘文件**

**–基于存储设备–**

常用为4种，设备存储都是不支持kvm的快照方式

**disk**：直接对硬盘读写
**iSCSI**：InternetSmallComputerSystemInterface，基于TCP/IP的协议，通过ip网络创建存储区域网络
**SCSI**：Small Computer System Interface，基于硬件智能设备，提供计算机与外部设备之间的接口标准
**LVM**：Logical Volume Manager，基于系统对磁盘分区进行管理的一种机制，LVM的优势在于可以使用快照，而快照并不是KVM虚拟化自带的功能
前三种都是基于访问磁盘的方式也存在缺点：不灵活，比较僵化。

**虚拟磁盘类型（存储卷）**

**raw**：代表虚拟机所使用的原始镜像

他并不存储元数据，因此可以作为保证虚拟机兼容性的候选方案。
不支持快照和压缩等高级特性（缺点）
存储卷创建多大，就会占用真实硬盘多大（缺点）
寻址简单，访问效率较高（优点）
可以通过格式转换工具方便地转换为其他格式（优点）
**cow** : copy-on-write格式，跟raw一样简单

cow有一个bitmap表记录当前哪些扇区被使用，所以cow可以使用增量镜像，支持快照
**qcow** : QEMU早期的cow

增加了动态增加文件大小的功能，并且支持加密，压缩
**qcow2**

按需分配磁盘空间，不管文件系统是否支持
支持快照
支持zlib的磁盘压缩
支持AES的加密
**vmdk**：VMware环境当中默认使用的磁盘格式

**vhd\vhdx**：微软默认采用的文件格式

## 二、基于LVM的存储池

```bash
lsblk        #检查块设备
pvcreate /dev/sdc    #创建物理卷
pvs        #查看物理卷
vgcreate quest /dev/sdc   #创建quest卷组
vgdisplay    #查看卷组
vgs    #显示卷组信息
```



```bash
virsh pool-list --all      #查看存储池tes
virsh vol-list test        #查看test卷
lvdisplay                  #查看逻辑卷

```

删除存储池

在图形化界面中删除

```bash
virsh pool-destroy guest
virsh pool-delete guest
virsh pool-undefine guest
vgs    #验证结果
```

使用命令创建


```bash
virsh pool-define-as guest --type logical --source-dev "/dev/sdc" --source-name=test
virsh pool-build guest 
virsh pool-start guest
virsh pool-autostart guest
```

